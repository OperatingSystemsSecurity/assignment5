---
title: Assignment 5
author:
  - Hendrik Werner s4549775
  - Aniek Den Teuling s1010747
date: \today
fontsize: 12pt
geometry: margin=5em
header-includes:
  - \usepackage{tikz}
---

# 1
If you do not use `bash` as your shell, to chroot into the Debian folder, run `chroot debian /bin/sh`, to avoid errors like this:

`chroot: failed to run command ‘/usr/bin/zsh’: No such file or directory`

If you use a Linux distribution that does not have Debian's executable folders in its `PATH`, you will have trouble running any commands. To rectify the problem, run `export PATH=$PATH:/usr/sbin/:/sbin:/bin`. After that you should be able to run commands like `ls` and `cd` like normal.

We followed the provided instructions, but they contain an error. We had to use `chroot` in place of `chdir` at step 5. After this change, breaking the chroot jail worked flawlessly.

## a
We can create a symbolic link, but it does not work inside the chroot jail:

```bash
hendrik ~ % echo test > testfile
hendrik ~ % cat testfile 
test
hendrik ~ % sudo ln -s testfile debian/testlink
hendrik ~ % sudo chroot debian /bin/bash
root@hendrik-oss:/# cat testlink 
cat: testlink: No such file or directory
root@hendrik-oss:/# ls -l testlink
lrwxrwxrwx 1 root root 8 Dec 18 19:09 testlink -> testfile
```

We tried to use the full path as well, but this does not work either:

```bash
hendrik ~ % sudo rm debian/testlink
hendrik ~ % sudo ln -s ~/testfile debian/testlink
hendrik ~ % sudo chroot debian /bin/bash
root@hendrik-oss:/# cat testlink
/bin/cat: testlink: No such file or directory
root@hendrik-oss:/# ls -l testlink
lrwxrwxrwx 1 root root 22 Dec 18 19:14 testlink -> /home/hendrik/testfile
```

Finally we tried a relative symlink, but this also does not work:

```bash
hendrik ~ % sudo rm debian/testlink
hendrik ~ % cd debian
hendrik ~/debian % sudo ln -rs ../testfile testlink
hendrik ~/debian % sudo chroot . /bin/bash
root@hendrik-oss:/# cat testlink
/bin/cat: testlink: No such file or directory
root@hendrik-oss:/# ls -l testlink
lrwxrwxrwx 1 root root 11 Dec 18 19:24 testlink -> ../testfile
```

## b
Hard links allow us to break the chroot jail:

```bash
hendrik ~ % echo test > testfile
hendrik ~ % cat testfile
test
hendrik ~ % sudo ln testfile debian/testlink
hendrik ~ % sudo chroot debian /bin/bash
root@hendrik-oss:/# cat testlink
test
```

The reason hard links still work is that they directly point to the inode on the file system, and symbolic links do not work because they point to a file, which points to the inode. Hard links create another handle for the inode, while symbolic links just create a handle for the original file which points to the inode. If the file is not reachable, the symbolic link cannot find the inode.

Here is an illustration of the concept:

\begin{tikzpicture}[
	every node/.style = {circle, draw, minimum width=7em},
	arrow/.style = {->, very thick},
	scale = 3,
]
	\node (inode) at (0, 1) {inode};
	\node (testfile) at (1, 0) {testfile};
	\node (hardlink) at (-1, 0) {hard link};
	\node (symlink) at (3, 0) {symbolic link};

	\draw[arrow] (testfile) -- (inode);
	\draw[arrow] (hardlink) -- (inode);
	\draw[arrow] (symlink) -- (testfile);
\end{tikzpicture}

## c
## d
The jailbreak does not work as an unprivileged user, because `chroot` can only be called as root, to prevent privilege escalation. If you could use `chroot` as a normal user, you could make your own versions of important files like `/etc/sudoers`, `/etc/shadow`, …

For example, by making your own custom `/etc/sudoers` file with your user name, then using `sudo`, which checks that file, you could get root privileges as a normal user. You cannot use `chroot` as a normal user though, so this scenario is prevented.

# 2
